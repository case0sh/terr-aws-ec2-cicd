- become: yes
  hosts: all
  name: apache-install
  tasks:

      
  - name: Add SSH key to 'root'
    authorized_key:
      user: root
      state: present
      key: "{{ lookup('file', pub_key) }}"
        
  # - name: packages | ensure apt list dir exists
  #   file:
  #     path: /var/lib/apt/lists/
  #     state: directory
  #     mode: 0755

  # - name: Update apt cache
  #   become: yes
  #   apt:
  #     update_cache: yes

  #install packages for ubuntu 20.04
  - name: Install additional packages
    become: yes
    apt:
      pkg:
        - ufw
        - vim
        - curl
        - htop
        - git 
        - certbot
        - nginx
    tags:
      - config.packages



## open ports
  - name: Deny all ingress connections
    community.general.ufw:
      policy: deny
      direction: incoming
    tags:
      - config.firewall
        
  - name: allow ingress ssh
    community.general.ufw:
      rule: allow
      port: ssh
      proto: tcp
      direction: in
    tags:
      - config.firewall

  - name: allow rpc ingress port
    community.general.ufw:
      rule: allow
      proto: tcp
      direction: in
      port: '80'
    tags:
      - config.firewall

  - name: allow ingress solana tcp ports
    community.general.ufw:
      rule: allow
      proto: tcp
      direction: in
      port: '443'
    tags:
      - config.firewall

  - name: Enable ufw
    community.general.ufw:
      state: enabled
    tags:
      - config.firewall
